<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Chatbox - 连接大模型</title>
  <style>
    /* 这里保持和之前的样式一致，省略 */
    /* ... 保持原有样式不变 ... */
  </style>
</head>
<body>

<div class="chatbox-container">
  <div class="chatbox-header">AI 聊天机器人</div>
  <div class="chatbox-body" id="chatBody">
    <div class="message bot-message">你好！我是AI助手，有什么问题我可以帮你？</div>
  </div>
  <div class="chatbox-footer">
    <input type="text" id="userInput" class="chatbox-input" placeholder="输入消息..." />
    <button class="chatbox-button" onclick="sendMessage()">发送</button>
  </div>
</div>

<script>
  async function sendMessage() {
    const input = document.getElementById("userInput");
    const message = input.value.trim();
    if (message === "") return;

    // 添加用户消息
    const userMsg = document.createElement("div");
    userMsg.className = "message user-message";
    userMsg.textContent = message;
    document.getElementById("chatBody").appendChild(userMsg);
    input.value = "";
    scrollToBottom();

    try {
      const response = await fetch("https://api.siliconflow.cn/v1/chat/completions ", {
        method: "POST",
        headers: {
          "Authorization": "Bearer YOUR_API_TOKEN_HERE", // 替换为你的 Token
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: "Qwen/QwQ-32B",
          messages: [{ role: "user", content: message }],
          stream: false,
          max_tokens: 512,
          enable_thinking: false,
          thinking_budget: 4096,
          min_p: 0.05,
          stop: null,
          temperature: 0.7,
          top_p: 0.7,
          top_k: 50,
          frequency_penalty: 0.5,
          n: 1,
          response_format: { type: "text" },
          tools: []
        })
      });

      const data = await response.json();

      // 显示模型回复
      const botMsg = document.createElement("div");
      botMsg.className = "message bot-message";
      botMsg.textContent = data.choices?.[0]?.message?.content || "抱歉，没有收到有效回答。";
      document.getElementById("chatBody").appendChild(botMsg);

    } catch (error) {
      console.error("请求失败:", error);
      const errorMsg = document.createElement("div");
      errorMsg.className = "message bot-message";
      errorMsg.style.color = "red";
      errorMsg.textContent = "连接服务器失败，请稍后再试。";
      document.getElementById("chatBody").appendChild(errorMsg);
    }

    scrollToBottom();
  }

  function scrollToBottom() {
    const chatBody = document.getElementById("chatBody");
    chatBody.scrollTop = chatBody.scrollHeight;
  }

  // 回车键发送
  document.getElementById("userInput").addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
      sendMessage();
    }
  });
</script>

</body>
</html>
